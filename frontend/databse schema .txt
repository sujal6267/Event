CREATE TABLE users (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('user','organizer','admin') DEFAULT 'user',
    profile_image VARCHAR(500)
);

CREATE TABLE categories (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    slug VARCHAR(100) UNIQUE NOT NULL,
    icon VARCHAR(10),
    description TEXT
);

CREATE TABLE events (
    id VARCHAR(50) PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    organizer_id VARCHAR(50),
    description TEXT,
    category_id VARCHAR(50),
    date DATE,
    time TIME,
    location VARCHAR(255),
    price DECIMAL(10,2),
    image VARCHAR(500),
    is_online BOOLEAN DEFAULT FALSE,
    online_link VARCHAR(500),
    status ENUM('pending','approved','rejected') DEFAULT 'pending',
    FOREIGN KEY (organizer_id) REFERENCES users(id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
);


CREATE TABLE ticket_types (
    id VARCHAR(50) PRIMARY KEY,
    event_id VARCHAR(50),
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10,2),
    quantity INT,
    FOREIGN KEY (event_id) REFERENCES events(id)
);


CREATE TABLE tickets (
    id VARCHAR(50) PRIMARY KEY,
    event_id VARCHAR(50),
    user_id VARCHAR(50),
    ticket_type_id VARCHAR(50),
    purchase_date DATE,
    status ENUM('valid','used','cancelled') DEFAULT 'valid',
    qr_code VARCHAR(500),
    FOREIGN KEY (event_id) REFERENCES events(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (ticket_type_id) REFERENCES ticket_types(id)
);

CREATE TABLE notifications (
    id VARCHAR(50) PRIMARY KEY,
    user_id VARCHAR(50),
    type ENUM('ticket','event','reminder','promo','system') DEFAULT 'system',
    title VARCHAR(255),
    message TEXT,
    event_id VARCHAR(50),
    ticket_id VARCHAR(50),
    read BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (event_id) REFERENCES events(id),
    FOREIGN KEY (ticket_id) REFERENCES tickets(id)
);

CREATE TABLE promotions (
    id VARCHAR(50) PRIMARY KEY,
    code VARCHAR(50) UNIQUE NOT NULL,
    type ENUM('percentage','fixed') NOT NULL,
    value DECIMAL(10,2),
    min_purchase DECIMAL(10,2),
    max_discount DECIMAL(10,2),
    valid_from DATE,
    valid_until DATE,
    usage_limit INT,
    used_count INT DEFAULT 0,
    event_id VARCHAR(50),
    is_active BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (event_id) REFERENCES events(id)
);


CREATE TABLE rsvps (
    id VARCHAR(50) PRIMARY KEY,
    event_id VARCHAR(50) NOT NULL,
    user_id VARCHAR(50) NOT NULL,
    status ENUM('confirmed','cancelled','attended') DEFAULT 'confirmed',
    rsvp_date DATE,
    checked_in_at DATETIME,
    FOREIGN KEY (event_id) REFERENCES events(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);





